#!/bin/bash

echo "=== ğŸ›¡ï¸ ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚¨ãƒ©ãƒ¼é˜²æ­¢ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³é…å¸ƒ ==="
echo ""

# ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé€šä¿¡ã®ç’°å¢ƒå¤‰æ•°ã‚’èª­ã¿è¾¼ã¿
if [ -f ".env_dentalsystem" ]; then
    source .env_dentalsystem
    PROJECT_NAME="dentalsystem"
else
    echo "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç’°å¢ƒãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
    exit 1
fi

# ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³é…å¸ƒãƒ­ã‚°è¨˜éŒ²
echo "[$(date '+%Y-%m-%d %H:%M:%S')] [GUIDELINE] [$PROJECT_NAME] [PRESIDENT] ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚¨ãƒ©ãƒ¼é˜²æ­¢ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³é…å¸ƒé–‹å§‹" >> development/development_log.txt

# boss1ã¸ã®æŒ‡ç¤º
echo "ğŸ“‹ boss1ã«ã‚¨ãƒ©ãƒ¼é˜²æ­¢ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³é…å¸ƒ..."
./agent-send.sh $PROJECT_NAME boss1 "ã€é‡è¦æŒ‡ç¤ºã€‘ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚¨ãƒ©ãƒ¼é˜²æ­¢ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã‚’ä½œæˆã—ã¾ã—ãŸã€‚development/deployment_error_prevention.md ã‚’å¿…ãšç¢ºèªã—ã€å…¨workerã«å‘¨çŸ¥ã—ã¦ãã ã•ã„ã€‚ä»Šå¾Œã®é–‹ç™ºã§ã¯ä»¥ä¸‹ã‚’å¾¹åº•ï¼š1)ãƒ‡ãƒ—ãƒ­ã‚¤å‰ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆå®Ÿè¡Œ 2)ç’°å¢ƒå¤‰æ•°ã®äº‹å‰æ¤œè¨¼ 3)ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®æœ¬ç•ªãƒ“ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆ 4)æ®µéšçš„ãƒªãƒªãƒ¼ã‚¹å®Ÿæ–½"

# å…¨workerã¸ã®å€‹åˆ¥æŒ‡ç¤º
workers=("worker1" "worker2" "worker3" "worker4" "worker5")

for worker in "${workers[@]}"; do
    echo "ğŸ“‹ ${worker}ã«ã‚¨ãƒ©ãƒ¼é˜²æ­¢ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³é…å¸ƒ..."
    ./agent-send.sh $PROJECT_NAME $worker "ã€å¿…é ˆéµå®ˆã€‘development/deployment_error_prevention.md ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚¨ãƒ©ãƒ¼é˜²æ­¢ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚ä»Šå¾Œã®é–‹ç™ºã§ã¯å¿…ãšä»¥ä¸‹ã‚’å®Ÿè¡Œï¼š1)ãƒ­ãƒ¼ã‚«ãƒ«ã§RAILS_ENV=production bundle exec rails assets:precompileå®Ÿè¡Œ 2)ç’°å¢ƒå¤‰æ•°ãƒã‚§ãƒƒã‚¯(rails deployment:check_env) 3)ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šãƒ†ã‚¹ãƒˆå®Ÿè¡Œ 4)ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã®å³åº§ã®å ±å‘Šã€‚ã“ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³é•åã¯é–‹ç™ºãƒ«ãƒ¼ãƒ«é•åã¨ãªã‚Šã¾ã™ã€‚"
done

# ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³è¦ç´„ã®ä½œæˆ
cat > development/error_prevention_summary.md << 'EOF'
# ğŸ›¡ï¸ ã‚¨ãƒ©ãƒ¼é˜²æ­¢ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³è¦ç´„

## å¿…é ˆå®Ÿè¡Œäº‹é …ï¼ˆå…¨é–‹ç™ºè€…ï¼‰

### ãƒ‡ãƒ—ãƒ­ã‚¤å‰ãƒã‚§ãƒƒã‚¯
1. `RAILS_ENV=production bundle exec rails assets:precompile`
2. `rails deployment:check_env`ï¼ˆç’°å¢ƒå¤‰æ•°ãƒã‚§ãƒƒã‚¯ï¼‰
3. `RAILS_ENV=production bundle exec rails db:version`ï¼ˆDBæ¥ç¶šãƒ†ã‚¹ãƒˆï¼‰

### é–‹ç™ºä¸­ã®æ³¨æ„ç‚¹
- ç’°å¢ƒå¤‰æ•°ã¯é–‹ç™ºåˆæœŸã‹ã‚‰æ˜ç¢ºã«å®šç¾©
- ãƒ­ãƒ¼ã‚«ãƒ«ãƒ»ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ãƒ»æœ¬ç•ªã§åŒã˜å¤‰æ•°åä½¿ç”¨
- ãƒãƒ¼ã‚¸ãƒ§ãƒ³å›ºå®šã¨æ˜ç¤ºçš„è¨˜è¼‰

### ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚
1. ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°åé›†
2. PRESIDENTãƒ»boss1ã«å³åº§å ±å‘Š
3. å½±éŸ¿ç¯„å›²ç‰¹å®š
4. å¿…è¦æ™‚ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯

## è²¬ä»»åˆ†æ‹…
- **PRESIDENT**: ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³éµå®ˆç›£ç£ãƒ»æœ€çµ‚åˆ¤æ–­
- **boss1**: ãƒãƒ¼ãƒ å‘¨çŸ¥ãƒ»ãƒã‚§ãƒƒã‚¯ç¢ºèªãƒ»ç¶™ç¶šæ”¹å–„
- **workers**: ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³éµå®ˆãƒ»ãƒ†ã‚¹ãƒˆå¾¹åº•ãƒ»å³åº§å ±å‘Š
EOF

echo ""
echo "âœ… å…¨ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³é…å¸ƒå®Œäº†"
echo ""
echo "ğŸ“‹ é…å¸ƒå†…å®¹ï¼š"
echo "  - development/deployment_error_prevention.mdï¼ˆè©³ç´°ã‚¬ã‚¤ãƒ‰ï¼‰"
echo "  - development/error_prevention_summary.mdï¼ˆè¦ç´„ç‰ˆï¼‰"
echo ""
echo "ğŸ“Š ä»Šå¾Œã®ãƒ‡ãƒ—ãƒ­ã‚¤ï¼š"
echo "  1. scripts/safe-deploy.sh ã‚’ä½¿ç”¨"
echo "  2. ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆå¿…é ˆå®Ÿè¡Œ"
echo "  3. ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã¯å³åº§å ±å‘Š"
echo ""

# å®Œäº†ãƒ­ã‚°è¨˜éŒ²
echo "[$(date '+%Y-%m-%d %H:%M:%S')] [COMPLETE] [$PROJECT_NAME] [PRESIDENT] ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚¨ãƒ©ãƒ¼é˜²æ­¢ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³é…å¸ƒå®Œäº†" >> development/development_log.txt

echo "ğŸ¯ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼š"
echo "1. å…¨ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ç¢ºèªå¿œç­”ã‚’å¾…ã¤"
echo "2. æœ¬ç•ªç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿè¡Œ"
echo "3. ãƒ‡ãƒ¢ç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿè¡Œ"