# 🦷 歯科クリニック予約管理システム - 基本仕様書

## 📋 システム概要

**目標**: 歯科医師・受付スタッフが顧客管理を簡単かつ適切に行える実用的なシステム

### 🎯 核心機能（Phase 1 - MVP）

#### 1. **多元予約チャネル統合**
- 📞 **電話予約**: 受付スタッフが手動入力
- 📱 **LINE予約**: LINE Bot統合（将来対応）
- 🌐 **ホットペッパービューティー**: API連携
- 🏥 **自社ホームページ**: Web予約フォーム
- 🔍 **ドクターズファイル**: 外部予約サイト連携

#### 2. **カレンダー統合予約管理**
- 📅 **一元カレンダー表示**: FullCalendar使用
- ⚡ **自動予約配置**: 各チャネルからの予約を自動統合
- 🔄 **リアルタイム更新**: 予約状況の即座反映
- ⏰ **時間枠管理**: 診療時間・休憩時間設定

#### 3. **自動リマインドシステム**
- 📧 **7日前リマインド**: 自動メール送信
- 📧 **3日前リマインド**: 最終確認メール
- 📱 **SMS対応**: 緊急時・当日リマインド（オプション）
- 🤖 **配信ログ管理**: 送信状況・開封率追跡

#### 4. **顧客管理システム**
- 👥 **患者基本情報**: 氏名・連絡先・生年月日
- 📋 **診療履歴**: 治療内容・来院日記録
- 🔍 **高速検索**: 名前・電話番号・メール検索
- 💾 **データ安全管理**: GDPR準拠・暗号化

---

## 🏗️ 技術アーキテクチャ

### **フロントエンド**
- **Framework**: Bootstrap 5.3 + Stimulus.js
- **カレンダー**: FullCalendar v6
- **UI/UX**: レスポンシブデザイン・モバイル対応
- **検索**: リアルタイム検索（50ms以下）

### **バックエンド**
- **Framework**: Ruby on Rails 7.2
- **Database**: PostgreSQL 16
- **Job Queue**: Sidekiq + Redis（リマインド処理）
- **API**: RESTful設計・JSON応答

### **外部連携**
- **メール**: ActionMailer + SMTP（Gmail/SendGrid）
- **SMS**: Twilio API（オプション）
- **予約API**: ホットペッパー・ドクターズファイル

---

## 📊 データベース設計

### **主要テーブル**

#### **Patients（患者）**
```ruby
- id (Primary Key)
- name (氏名)
- name_kana (フリガナ)
- email (メールアドレス)
- phone (電話番号)
- date_of_birth (生年月日)
- address (住所)
- emergency_contact (緊急連絡先)
- notes (特記事項)
- created_at, updated_at
```

#### **Appointments（予約）**
```ruby
- id (Primary Key)
- patient_id (患者ID - Foreign Key)
- appointment_date (予約日)
- appointment_time (予約時間)
- end_time (終了時間)
- treatment_type (治療種別)
- status (ステータス: pending/confirmed/completed/cancelled)
- source (予約元: phone/hotpepper/website/doctors_file)
- notes (メモ)
- created_at, updated_at
```

#### **Reminders（リマインド）**
```ruby
- id (Primary Key)
- appointment_id (予約ID - Foreign Key)
- reminder_type (種別: 7days/3days/1day)
- sent_at (送信日時)
- delivery_status (配信状況: pending/sent/delivered/failed)
- email_opened_at (開封日時)
- created_at, updated_at
```

#### **Reservation_Sources（予約元設定）**
```ruby
- id (Primary Key)
- name (予約元名称)
- api_endpoint (API エンドポイント)
- api_key (API キー)
- active (有効/無効)
- settings (JSON設定)
```

---

## 🎮 ユーザーインターフェース

### **受付スタッフ向け画面**

#### **1. ダッシュボード**
- 📊 今日の予約一覧
- 📈 予約統計（今日・今週・今月）
- 🚨 アラート（未確認予約・キャンセル等）
- ⚡ クイックアクション（新規予約・患者検索）

#### **2. カレンダー画面**
- 📅 月・週・日表示切り替え
- 🖱️ ドラッグ&ドロップ予約移動
- ➕ ワンクリック新規予約
- 🔍 予約詳細ポップアップ

#### **3. 患者管理画面**
- 🔍 高速リアルタイム検索
- 📋 患者詳細・履歴表示
- ✏️ 情報編集・新規登録
- 📞 予約履歴・リマインド状況

#### **4. 予約管理画面**
- 📝 予約作成・編集・キャンセル
- 📊 予約元別統計
- 🔄 ステータス一括管理
- 📧 手動リマインド送信

---

## ⚡ 自動化フロー

### **予約受付フロー**
```
外部予約 → API受信 → 重複チェック → カレンダー反映 → 確認メール送信
```

### **リマインドフロー**
```
Daily Job → 7日前/3日前抽出 → メール生成 → 送信実行 → 配信ログ記録
```

### **予約管理フロー**
```
予約作成 → 患者情報確認 → 時間枠チェック → 予約確定 → リマインド設定
```

---

## 🚀 開発段階（MVP → 完全版）

### **Phase 1: MVP（最小実用製品）**
1. ✅ 基本CRUD（患者・予約）
2. ✅ シンプルカレンダー表示
3. ✅ 電話予約入力画面
4. ✅ 基本リマインドメール
5. ✅ 受付スタッフ向けUI

### **Phase 2: 統合強化**
1. 🔄 ホットペッパー API連携
2. 🌐 自社サイト予約フォーム
3. 📧 高度リマインドシステム
4. 📊 予約統計・レポート
5. 📱 モバイル最適化

### **Phase 3: 高度機能**
1. 🤖 LINE Bot統合
2. 📱 SMS リマインド
3. 🔍 AI分析・予測（将来）
4. 🏥 多院展開対応
5. 🔐 高度セキュリティ

---

## 🎯 成功指標（KPI）

### **運用効率**
- 📞 予約受付時間: 30秒以内
- 🔍 患者検索時間: 5秒以内
- 📧 リマインド配信率: 99%以上
- ❌ 予約重複率: 0%

### **ユーザー満足度**
- 👥 受付スタッフ満足度: 90%以上
- 📱 システム応答速度: 200ms以下
- 🚫 システムダウン時間: 月1時間以下
- 🔄 予約変更対応時間: 1分以内

---

## 📅 開発スケジュール

### **週1-2: MVP基盤構築**
- データベース設計・実装
- 基本CRUD機能
- シンプルUI作成

### **週3-4: カレンダー統合**
- FullCalendar統合
- 予約表示・操作機能
- リアルタイム更新

### **週5-6: リマインドシステム**
- メール送信機能
- Sidekiq Job設定
- 配信ログ管理

### **週7-8: テスト・リリース**
- 統合テスト
- ユーザビリティテスト
- 本番環境構築

---

**🎊 目標: 8週間で実用的な歯科予約管理システムをリリース！**