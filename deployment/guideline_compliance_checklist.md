# ✅ デプロイメントエラー防止ガイドライン遵守チェックリスト

**対象**: 全開発者（PRESIDENT、boss1、worker1-5）  
**基準文書**: development/deployment_error_prevention.md  
**遵守義務**: 必須（違反は開発ルール違反）  

---

## 🚨 必須遵守事項

### 1️⃣ ローカルでの本番ビルドテスト
```bash
# 必須実行コマンド
RAILS_ENV=production bundle exec rails assets:precompile
```
- [ ] 開発開始時に1回実行
- [ ] 大きな変更後に実行
- [ ] デプロイ前に必ず実行
- [ ] エラー発生時は即座に報告

### 2️⃣ 環境変数チェック
```bash
# 必須実行コマンド
bundle exec rails deployment:check_env
```
- [ ] 新しい環境変数追加時に実行
- [ ] デプロイ前に必ず実行
- [ ] 全ての必須変数が設定済みであることを確認

### 3️⃣ データベース接続テスト
```bash
# 必須実行コマンド
RAILS_ENV=production bundle exec rails db:version
```
- [ ] DATABASE_URL変更時に実行
- [ ] デプロイ前に必ず実行
- [ ] 接続エラー時は即座に報告

### 4️⃣ エラー発生時の即座の報告
- [ ] PRESIDENTへの即時エスカレーション
- [ ] development_log.txtへの詳細記録
- [ ] エラー内容と対応策の文書化

---

## 📋 開発フロー別チェックリスト

### 新機能開発時
- [ ] development/deployment_error_prevention.md を確認
- [ ] 必要な環境変数を事前に定義
- [ ] ローカルでの本番ビルドテスト実行
- [ ] 開発ログに進捗を詳細記録

### デプロイ前
- [ ] 全ての必須遵守事項を実行
- [ ] deployment:check タスクで総合チェック
- [ ] scripts/safe_deploy.sh の使用推奨
- [ ] チェック結果をログに記録

### エラー発生時
- [ ] エラー内容の即座の報告
- [ ] ガイドライン違反かどうかの確認
- [ ] 修正後の再チェック実行
- [ ] 再発防止策の検討・実装

---

## 🎯 役割別責任

### PRESIDENT
- [ ] ガイドライン遵守の監督
- [ ] 違反時の最終判断
- [ ] ガイドライン改定の承認

### boss1
- [ ] チーム全体への周知徹底
- [ ] 違反時の指導・修正指示
- [ ] 定期的な遵守状況確認

### workers
- [ ] 日常開発でのガイドライン遵守
- [ ] 必須コマンドの確実な実行
- [ ] 問題発生時の即座の報告

---

## 🔧 利用可能なツール

### 自動チェックスクリプト
```bash
# 環境変数のみチェック
bundle exec rails deployment:check_env

# データベース接続のみチェック
RAILS_ENV=production bundle exec rails db:version

# 総合チェック
bundle exec rails deployment:check

# セーフデプロイ（全自動）
./scripts/safe_deploy.sh
```

### 手動チェック
```bash
# アセットプリコンパイル
RAILS_ENV=production bundle exec rails assets:precompile

# 本番環境での起動テスト
RAILS_ENV=production bundle exec rails server -p 3001
```

---

## ⚠️ 違反パターンと対策

### よくある違反例
1. **環境変数未設定でのデプロイ**
   - 対策: deployment:check_env の必須実行

2. **アセットプリコンパイル未実行**
   - 対策: ローカルでの事前実行を必須化

3. **データベース接続確認漏れ**
   - 対策: db:version コマンドの必須実行

4. **エラー報告の遅延**
   - 対策: 即座の報告体制確立

### 重大違反時の対応
- 即座の作業停止
- PRESIDENTへの緊急報告
- 原因分析と対策検討
- ガイドライン改定の検討

---

## 📊 遵守状況の記録

### チェック実行記録
```
日時: 2025-06-30 02:30:00
担当: worker4
実行項目:
  ✅ 環境変数チェック
  ✅ DB接続テスト
  ✅ アセットプリコンパイル
  ✅ 総合チェック
結果: 全項目合格
```

### 違反記録（例）
```
日時: 2025-06-30 01:00:00
担当: worker3
違反内容: SECRET_KEY_BASE未設定でデプロイ実行
対応: 即座に修正、再チェック実行
学習: .env.example の更新
```

---

## 🔄 継続的改善

### 月次レビュー
- [ ] ガイドライン遵守率の確認
- [ ] 新しいエラーパターンの分析
- [ ] ツールの改善・追加

### チーム学習
- [ ] 違反事例の共有
- [ ] ベストプラクティスの更新
- [ ] 新メンバーへの教育

---

## 📞 緊急時連絡先

| 役割 | 担当者 | 対応内容 |
|------|--------|----------|
| **最終責任者** | PRESIDENT | ガイドライン違反の最終判断 |
| **チーム管理** | boss1 | 違反時の初期対応・指導 |
| **技術サポート** | worker4 | ガイドライン技術的支援 |

---

**重要**: このチェックリストは生きた文書です。新しい知見や改善点があれば即座に更新し、チーム全体で共有してください。

**最終更新**: 2025-06-30  
**次回レビュー予定**: 2025-07-30