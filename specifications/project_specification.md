# 歯科クリニック予約・業務管理システム 仕様書

## 0. 本書の目的

本書は「歯科クリニック予約・業務管理システム」の設計・開発に携わる全メンバーが、共通の"北極星"を見失わないための羅針盤である。
要件定義書が「なぜ、何をつくるのか」を示すのに対し、本書は「どのように実装し、どのように運用するのか」を具体化する。すなわち、本書は戦略を戦術に翻訳する"生きたドキュメント"であり、受付スタッフ・エンジニア・院長すべての視点を束ねるハブとなる。

### 0.0.1 なぜ今、内製するのか
- **紙台帳依存からの脱却** ― 重複予約・転記ミス・集計工数は紙運用では根本解決できない。
- **汎用クラウド予約システムの限界** ― 医療固有のフロー（問診→検査→処置→会計）や労基法に沿った給与計算をノーコードで吸収するのは困難。
- **データを資産に変える** ― 予約・カルテ・売上・勤怠を一気通貫で把握することで経営判断の精度を高める。
- **コストコントロール** ― 席単価課金SaaSは多店舗化で固定費を圧迫。内製モノリス＋Lightsailなら月額 < ¥6,000。

### 0.0.2 本書が提供するもの
1. **開発者へのガイドライン** ― コーディング規約・ブランチ戦略・レビュー基準を明示し属人化を防ぐ。
2. **プロダクトオーナーへの可視化** ― KPI・リスク・マイルストーンを定義し意思決定を迅速化。
3. **運用担当への運営マニュアル** ― デプロイ、障害対応、バージョン管理の手順を統一。
4. **品質保証チームへの試験基準** ― カバレッジ、性能閾値、UX指標を数値で示し合否を客観化。

## 0.1 システム利用者のニーズと達成ゴール

本システムの最上位ゴールは「診療という複雑なオーケストラを最少人数で完璧に演奏する」こと。
四つの主要ペルソナの潜在フラストレーションからゴール、提供価値を整理する。

### 0.1.1 ペルソナ別ストーリー

| ペルソナ | フラストレーション | ゴール | システムが提供する価値 |
|---------|-------------------|-------|---------------------|
| 受付スタッフ・高橋さん（46歳・時短勤務） | 紙台帳と予約サイトを行き来し重複チェックに神経をすり減らす | 患者名1行入力→30秒以内に予約確定 | ワンライン入力UI、リアルタイム重複警告 |
| 院長・山田先生（38歳・開業4年目） | 予約重複・勤怠集計・数字の可視化に時間を奪われる | 重複ゼロ、給与確定ワンクリック、主要KPIが毎朝メール | 統合台帳、給与エンジン、ダッシュボード |
| 患者・佐藤さん（32歳・共働き・2児の母） | 診療時間中しか電話できず予約変更が不便 | LINEで24h予約確認／変更、リマインドでうっかり防止 | LINE Bot連携、7・3・当日リマインド |
| スポット衛生士・小川さん（29歳・フリーランス） | 条件に合う医院を探すのに電話は高ハードル | 空きスケジュール登録→求人自動レコメンド | 求人カレンダー＋プッシュ通知 (Phase 2) |

### 0.1.2 ユーザージャーニー概観
1. **発見** — 患者が検索→オンライン予約ボタンをタップ
2. **予約** — LINEミニアプリで空き枠即確保／台帳即反映
3. **準備** — 7日・3日前の自動リマインド＋事前問診票リンク
4. **来院** — 受付1クリックでステータス更新
5. **診療** — 医師のiPadに履歴と注意点を自動ハイライト
6. **会計** — 完了時に売上実績ダッシュボード反映
7. **再来院** — 6か月後にリコール通知→再予約

### 0.1.3 成功を測る5つの鍵指標

| KPI | 現状 | 目標 |
|-----|------|------|
| チェア稼働率 | 80% | 95% |
| 前日キャンセル率 | 12% | 5% |
| 予約登録平均時間 | 2分 | 30秒 |
| 給与計算作業時間 | 2h／月 | 10min／月 |
| 再来院率 | 60% | 85% |

メトリクス駆動 ― すべての機能はこれらKPIのどれを改善するかを明示し、A/Bテストまたは月次比較で効果検証する。

## 0.2 ユーザーの経営課題と必要機能詳細

本システムは「患者1人当たりの粗利最大化」と「運営コスト最小化」を同時に達成する経営プラットフォームである。

### 0.2.1 経営課題と定量目標

| # | 経営課題 | 痛点 | 目標KPI |
|---|---------|------|---------|
| 1 | チェア稼働率最大化 | ダブルブッキング／空き枠放置 | 稼働率95% |
| 2 | リコール再来院 | 手動電話で機会損失 | 再来率85% |
| 3 | キャンセル削減 | 前日・当日キャンセル多発 | キャンセル率5% |
| 4 | 人件費効率化 | タイムカード手集計 | 集計工数10min／月 |
| 5 | 一貫した患者体験 | カルテ・会計分断 | 会計漏れゼロ |
| 6 | データドリブン経営 | KPIが即時見えない | ダッシュボード即時反映 |
| 7 | 人材不足対応 | 衛生士確保難 | スポット採用1クリック |

### 0.2.2 課題と機能マッピング（概要）

| 課題# | 必要機能 | 期待効果 |
|-------|---------|---------|
| 1,3 | 予約統合カレンダー | 稼働率向上、重複ゼロ |
| 2 | 自動リコール／リマインド | No-show減、再来増 |
| 4 | 勤怠打刻＋給与エンジン | 工数90%削減 |
| 5 | 患者カルテ統合ビュー | 受付業務短縮 |
| 6 | リアルタイムダッシュボード | 即時経営判断 |
| 7 | スポット衛生士マッチング | 人材確保柔軟化 |

## 1. システム設計原則

### 1.1 アーキテクチャ方針
- **モノリス優先**: 初期はRails monolithで迅速開発、必要に応じてマイクロサービス化
- **データ統合**: 予約・カルテ・売上・勤怠の一元管理
- **リアルタイム性**: WebSocketsによる即座反映
- **拡張性**: 多店舗対応を前提とした設計

### 1.2 技術スタック
- **Backend**: Ruby on Rails 7.x
- **Frontend**: Hotwire (Turbo + Stimulus)
- **Database**: PostgreSQL
- **Cache**: Redis
- **Deployment**: Railway/Heroku
- **External**: LINE Messaging API

### 1.3 品質基準
- **Performance**: 応答時間 < 200ms
- **Availability**: 稼働率 > 99.9%
- **Security**: 医療情報保護法準拠
- **Usability**: 30秒以内予約完了