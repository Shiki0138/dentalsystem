# ğŸš€ 160å€é«˜é€ŸåŒ–ã‚·ã‚¹ãƒ†ãƒ å°‚ç”¨ è¶…é«˜é€Ÿã‚¢ãƒ©ãƒ¼ãƒˆãƒ«ãƒ¼ãƒ«
# worker4ã®é©å‘½çš„é«˜é€ŸåŒ–æˆæœã«æœ€é©åŒ–ã•ã‚ŒãŸç›£è¦–è¨­å®š

groups:
  - name: ultra_speed_revolution_critical
    interval: 1s  # 1ç§’é–“éš”ã®è¶…é«˜é€Ÿç›£è¦–
    rules:
      # 160å€é«˜é€ŸåŒ–ã‚·ã‚¹ãƒ†ãƒ å°‚ç”¨ã‚¢ãƒ©ãƒ¼ãƒˆ
      - alert: SpeedRevolutionFailure
        expr: speed_improvement_ratio{job="dental-system"} < 150
        for: 10s  # 10ç§’ã§å³åº§ã«æ¤œçŸ¥
        labels:
          severity: critical
          revolution_impact: extreme
          worker4_achievement: threatened
        annotations:
          summary: "ğŸš¨ 160å€é«˜é€ŸåŒ–ã‚·ã‚¹ãƒ†ãƒ æ€§èƒ½åŠ£åŒ–"
          description: "worker4ãŒå®Ÿç¾ã—ãŸ160å€é«˜é€ŸåŒ–ãŒ {{ $value }}å€ã«ä½ä¸‹ï¼å³åº§ã«å¯¾å¿œãŒå¿…è¦ã§ã™"
          runbook_url: "https://dental-revolution.com/runbooks/speed-degradation"
          
      # è¶…é«˜é€Ÿãƒ¬ã‚¹ãƒãƒ³ã‚¹ç›£è¦–ï¼ˆãƒŸãƒªç§’å˜ä½ï¼‰
      - alert: UltraFastResponseDegradation
        expr: |
          histogram_quantile(0.99, 
            rate(http_request_duration_seconds_bucket{job="dental-system"}[30s])
          ) * 1000 > 10
        for: 30s
        labels:
          severity: critical
          performance_tier: ultra_fast
          optimization_level: maximum
        annotations:
          summary: "âš¡ è¶…é«˜é€Ÿãƒ¬ã‚¹ãƒãƒ³ã‚¹åŠ£åŒ–æ¤œå‡º"
          description: "99%ã‚¿ã‚¤ãƒ«ãŒ {{ $value }}msã«é”ã—ã¦ã„ã¾ã™ï¼ˆç›®æ¨™: 10msä»¥ä¸‹ï¼‰"
          context: "160å€é«˜é€ŸåŒ–ã®æ©æµãŒå¤±ã‚ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™"
          
      # é©å‘½çš„ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆç›£è¦–
      - alert: RevolutionaryThroughputDrop
        expr: |
          rate(http_requests_total{job="dental-system"}[1m]) * 60 < 
          rate(http_requests_total{job="dental-system"}[1h] offset 1h) * 60 * 0.8
        for: 2m
        labels:
          severity: warning
          throughput_category: revolutionary
          impact_scope: user_experience
        annotations:
          summary: "ğŸ“‰ é©å‘½çš„ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆä½ä¸‹"
          description: "ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆãŒéå»1æ™‚é–“ã®å¹³å‡ã‹ã‚‰20%ä»¥ä¸Šä½ä¸‹ã—ã¦ã„ã¾ã™"
          
  - name: ultra_speed_database_performance
    interval: 5s
    rules:
      # è¶…é«˜é€ŸDBç›£è¦–ï¼ˆworker4æœ€é©åŒ–å¯¾å¿œï¼‰
      - alert: UltraFastQueryDegradation
        expr: |
          avg(pg_stat_statements_mean_time_seconds{job="postgresql"}) * 1000 > 2
        for: 30s
        labels:
          severity: warning
          component: database
          optimization_level: ultra_fast
        annotations:
          summary: "ğŸ—„ï¸ è¶…é«˜é€Ÿã‚¯ã‚¨ãƒªæ€§èƒ½åŠ£åŒ–"
          description: "å¹³å‡ã‚¯ã‚¨ãƒªå®Ÿè¡Œæ™‚é–“ãŒ {{ $value }}msã§ã™ï¼ˆç›®æ¨™: 2msä»¥ä¸‹ï¼‰"
          
      # ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹åŠ¹ç‡ç›£è¦–ï¼ˆ160å€é«˜é€ŸåŒ–å¯¾å¿œï¼‰
      - alert: IndexEfficiencyDrop
        expr: |
          avg(
            pg_stat_database_tup_fetched{job="postgresql"} / 
            (pg_stat_database_tup_returned{job="postgresql"} + 1)
          ) * 100 < 95
        for: 5m
        labels:
          severity: warning
          optimization_area: indexing
        annotations:
          summary: "ğŸ“Š ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹åŠ¹ç‡ä½ä¸‹"
          description: "ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹åŠ¹ç‡ãŒ {{ $value }}%ã«ä½ä¸‹ï¼ˆç›®æ¨™: 95%ä»¥ä¸Šï¼‰"
          
  - name: ultra_speed_cache_optimization
    interval: 10s
    rules:
      # è¶…é«˜é€Ÿã‚­ãƒ£ãƒƒã‚·ãƒ¥ç›£è¦–
      - alert: CacheHitRatioDrop
        expr: cache_hit_ratio{job="dental-system"} * 100 < 98
        for: 1m
        labels:
          severity: warning
          optimization_component: cache
          speed_impact: high
        annotations:
          summary: "ğŸ’¾ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆç‡ä½ä¸‹"
          description: "ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆç‡ãŒ {{ $value }}%ï¼ˆç›®æ¨™: 98%ä»¥ä¸Šï¼‰"
          impact: "160å€é«˜é€ŸåŒ–åŠ¹æœãŒæ¸›å°‘ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™"
          
      # Redisæ€§èƒ½ç›£è¦–ï¼ˆè¶…é«˜é€Ÿå¯¾å¿œï¼‰
      - alert: RedisPerformanceDegradation
        expr: redis_commands_duration_seconds_total{job="redis"} > 0.001
        for: 30s
        labels:
          severity: critical
          component: redis
          speed_tier: ultra_fast
        annotations:
          summary: "ğŸ”´ Redisæ€§èƒ½åŠ£åŒ–"
          description: "Redisã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œæ™‚é–“ãŒ {{ $value }}ç§’ï¼ˆç›®æ¨™: 1msä»¥ä¸‹ï¼‰"
          
  - name: revolutionary_quality_speed_balance
    interval: 30s
    rules:
      # å“è³ªÃ—é«˜é€ŸåŒ–ãƒãƒ©ãƒ³ã‚¹ç›£è¦–
      - alert: QualitySpeedImbalance
        expr: |
          (quality_score{job="dental-system"} < 95) and 
          (speed_improvement_ratio{job="dental-system"} > 160)
        for: 5m
        labels:
          severity: warning
          balance_type: quality_speed
          optimization_concern: true
        annotations:
          summary: "âš–ï¸ å“è³ªÃ—é«˜é€ŸåŒ–ãƒãƒ©ãƒ³ã‚¹è­¦å‘Š"
          description: "é«˜é€ŸåŒ–ã¯ç¶­æŒã•ã‚Œã¦ã„ã‚‹ãŒå“è³ªã‚¹ã‚³ã‚¢ãŒ {{ $value }}ç‚¹ã«ä½ä¸‹"
          
      # é©å‘½çš„åŠ¹ç‡ç›£è¦–
      - alert: RevolutionaryEfficiencyDrop
        expr: |
          clinic_efficiency_improvement{job="dental-system"} < 
          speed_improvement_ratio{job="dental-system"} * 2
        for: 10m
        labels:
          severity: warning
          efficiency_category: revolutionary
          business_impact: medium
        annotations:
          summary: "ğŸ“ˆ é©å‘½çš„åŠ¹ç‡æ”¹å–„ã®ä¸æ•´åˆ"
          description: "160å€é«˜é€ŸåŒ–ã«å¯¾ã—ã¦åŠ¹ç‡æ”¹å–„ãŒè¿½ã„ã¤ã„ã¦ã„ã¾ã›ã‚“"
          
  - name: user_experience_ultra_optimization
    interval: 15s
    rules:
      # è¶…é«˜é€Ÿãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ã‚¯ã‚¹ãƒšãƒªã‚¨ãƒ³ã‚¹
      - alert: UltraFastUXDegradation
        expr: |
          avg(page_load_time_seconds{job="dental-system"}) > 0.5
        for: 1m
        labels:
          severity: warning
          ux_tier: ultra_fast
          user_impact: high
        annotations:
          summary: "ğŸ–¥ï¸ è¶…é«˜é€ŸUXåŠ£åŒ–"
          description: "ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚é–“ãŒ {{ $value }}ç§’ï¼ˆç›®æ¨™: 0.5ç§’ä»¥ä¸‹ï¼‰"
          
      # APIå¿œç­”é€Ÿåº¦ï¼ˆè¶…é«˜é€ŸåŸºæº–ï¼‰
      - alert: APIResponseSpeedDrop
        expr: |
          histogram_quantile(0.95, 
            rate(api_request_duration_seconds_bucket{job="dental-system"}[1m])
          ) * 1000 > 50
        for: 2m
        labels:
          severity: warning
          api_performance: ultra_fast
          service_tier: premium
        annotations:
          summary: "ğŸ”Œ APIå¿œç­”é€Ÿåº¦ä½ä¸‹"
          description: "API 95%ã‚¿ã‚¤ãƒ«ãŒ {{ $value }}msï¼ˆç›®æ¨™: 50msä»¥ä¸‹ï¼‰"
          
  - name: concurrent_load_ultra_handling
    interval: 5s
    rules:
      # è¶…é«˜é€ŸåŒæ™‚å‡¦ç†èƒ½åŠ›
      - alert: ConcurrentLoadHandlingDrop
        expr: |
          active_connections{job="dental-system"} > 1000 and
          avg(response_time_under_load_ms{job="dental-system"}) > 100
        for: 1m
        labels:
          severity: critical
          load_category: concurrent_ultra
          scalability_impact: high
        annotations:
          summary: "ğŸ”„ è¶…é«˜é€ŸåŒæ™‚å‡¦ç†èƒ½åŠ›ä½ä¸‹"
          description: "é«˜è² è·æ™‚({{ $labels.active_connections }}æ¥ç¶š)ã®å¿œç­”æ™‚é–“ãŒåŠ£åŒ–"
          
# 160å€é«˜é€ŸåŒ–å°‚ç”¨é€šçŸ¥è¨­å®š
alerting:
  alertmanagers:
    - static_configs:
        - targets:
            - alertmanager:9093
            
# è¶…é«˜é€Ÿã‚·ã‚¹ãƒ†ãƒ ç”¨ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®š
global:
  evaluation_interval: 1s  # 1ç§’è©•ä¾¡é–“éš”ï¼ˆæœ€é«˜ç²¾åº¦ï¼‰
  external_labels:
    monitor: 'dental-revolution-160x'
    optimization_level: 'ultra_fast'
    worker4_achievement: 'enabled'

# é©å‘½çš„é€šçŸ¥ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
route:
  group_by: ['alertname', 'severity', 'revolution_impact']
  group_wait: 1s     # 1ç§’å¾…æ©Ÿï¼ˆå³åº§é€šçŸ¥ï¼‰
  group_interval: 5s  # 5ç§’é–“éš”ï¼ˆé«˜é »åº¦æ›´æ–°ï¼‰
  repeat_interval: 30m # 30åˆ†é–“éš”ï¼ˆé©åº¦ãªå†é€šçŸ¥ï¼‰
  receiver: 'revolution-team'
  
  routes:
    # 160å€é«˜é€ŸåŒ–é–¢é€£ã¯æœ€å„ªå…ˆ
    - match:
        worker4_achievement: threatened
      receiver: 'speed-revolution-emergency'
      group_wait: 0s
      continue: true
      
    # è¶…é«˜é€Ÿã‚·ã‚¹ãƒ†ãƒ å°‚ç”¨ãƒ«ãƒ¼ãƒˆ
    - match:
        optimization_level: ultra_fast
      receiver: 'ultra-speed-team'
      
    # é©å‘½ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆæ¥µå¤§ã¯çµŒå–¶å±¤ã¸
    - match:
        revolution_impact: extreme
      receiver: 'executive-team'

# 160å€é«˜é€ŸåŒ–å°‚ç”¨é€šçŸ¥å…ˆ
receivers:
  - name: 'revolution-team'
    slack_configs:
      - api_url: '${SLACK_WEBHOOK_URL}'
        channel: '#dental-revolution-160x'
        title: 'ğŸš€ 160å€é«˜é€ŸåŒ–ã‚·ã‚¹ãƒ†ãƒ ç›£è¦–'
        text: |
          worker4å®Ÿç¾ã®160å€é«˜é€ŸåŒ–ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ©ãƒ¼ãƒˆ
          {{ range .Alerts }}{{ .Annotations.summary }}{{ end }}
        send_resolved: true
        
  - name: 'speed-revolution-emergency'
    slack_configs:
      - api_url: '${SLACK_WEBHOOK_URL}'
        channel: '#speed-revolution-emergency'
        title: 'ğŸš¨ 160å€é«˜é€ŸåŒ–ç·Šæ€¥äº‹æ…‹'
        color: 'danger'
    pagerduty_configs:
      - service_key: '${PAGERDUTY_SPEED_REVOLUTION_KEY}'
        description: '160å€é«˜é€ŸåŒ–ã‚·ã‚¹ãƒ†ãƒ ã®æ€§èƒ½åŠ£åŒ–ç·Šæ€¥äº‹æ…‹'
        
  - name: 'ultra-speed-team'
    email_configs:
      - to: 'ultra-speed-team@dental-revolution.com'
        subject: 'âš¡ è¶…é«˜é€Ÿã‚·ã‚¹ãƒ†ãƒ ç›£è¦–ã‚¢ãƒ©ãƒ¼ãƒˆ'
        
  - name: 'executive-team'
    email_configs:
      - to: 'executives@dental-revolution.com'
        subject: 'ğŸ† æ­¯ç§‘æ¥­ç•Œé©å‘½ã‚·ã‚¹ãƒ†ãƒ é‡è¦ã‚¢ãƒ©ãƒ¼ãƒˆ'

# æŠ‘åˆ¶ãƒ«ãƒ¼ãƒ«ï¼ˆå½é™½æ€§é˜²æ­¢ï¼‰
inhibit_rules:
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'job']
    
  # 160å€é«˜é€ŸåŒ–åŠ£åŒ–æ™‚ã¯ä»–ã®è­¦å‘Šã‚’æŠ‘åˆ¶
  - source_match:
      worker4_achievement: 'threatened'
    target_match_re:
      severity: 'warning|info'
    equal: ['job']